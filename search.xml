<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Pandas习题-盖若(多级索引/数据合并/数据清洗)</title>
      <link href="/posts/141de9b.html"/>
      <url>/posts/141de9b.html</url>
      
        <content type="html"><![CDATA[<h1 id="Pandas习题-盖若-多级索引-数据合并-数据清洗"><a href="#Pandas习题-盖若-多级索引-数据合并-数据清洗" class="headerlink" title="Pandas习题 - 盖若(多级索引&#x2F;数据合并&#x2F;数据清洗)"></a>Pandas习题 - 盖若(多级索引&#x2F;数据合并&#x2F;数据清洗)</h1><h2 id="指定列为基准相加两个数据"><a href="#指定列为基准相加两个数据" class="headerlink" title="指定列为基准相加两个数据"></a><a href="https://gairuo.com/m/pandas-adds-two-data-specified-column">指定列为基准相加两个数据</a></h2><blockquote><p>题目：以 x1 和 x2 为基础，将 value1 和 value2 两个列的对应数据相加，最终数据以先 df1 后 df2 为顺序的</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">data1 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x1 x2 value1 value2</span></span><br><span class="line"><span class="string"> A  C      1      2</span></span><br><span class="line"><span class="string"> B  D      3      4</span></span><br><span class="line"><span class="string"> C  E      5      6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">data2 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> x1   x2  value1  value2</span></span><br><span class="line"><span class="string">  A    E     1.0     2.0</span></span><br><span class="line"><span class="string">  B    D     3.0     4.0</span></span><br><span class="line"><span class="string">  C    F     5.0     6.0</span></span><br><span class="line"><span class="string">  B  NaN     3.0     NaN</span></span><br><span class="line"><span class="string">NaN    T     NaN     NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df1 = pd.read_csv(io.StringIO(data1), sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br><span class="line">df2 = pd.read_csv(io.StringIO(data2), sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df1.set_index([<span class="string">&quot;x1&quot;</span>,<span class="string">&quot;x2&quot;</span>],inplace=<span class="literal">True</span>)</span><br><span class="line">df2.set_index([<span class="string">&quot;x1&quot;</span>,<span class="string">&quot;x2&quot;</span>],inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">(</span><br><span class="line">    df1.add(df2,fill_value=<span class="number">0</span>)</span><br><span class="line">    .reindex(df1.index.append(df2.index))</span><br><span class="line">    .reset_index()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="对多层索引的部分列进行数字格式化"><a href="#对多层索引的部分列进行数字格式化" class="headerlink" title="对多层索引的部分列进行数字格式化"></a><a href="https://gairuo.com/m/pandas-multi-index-columns-formatting">对多层索引的部分列进行数字格式化</a></h2><blockquote><p>习题：对「毛利率」这一层以下的数据进行格式化，保留两位小数增加百分号，如 12.20%</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    (<span class="string">&#x27;SKU编码&#x27;</span>, <span class="string">&#x27;len&#x27;</span>): &#123;(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>): <span class="number">19</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>): <span class="number">12</span>&#125;,</span><br><span class="line">    (<span class="string">&#x27;SKU编码&#x27;</span>, <span class="string">&#x27;long&#x27;</span>): &#123;(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>): <span class="number">54</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>): <span class="number">75</span>&#125;,</span><br><span class="line">    (<span class="string">&#x27;毛利率&#x27;</span>, <span class="string">&#x27;min&#x27;</span>): &#123;(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>): <span class="number">0.0588</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>): <span class="number">0.0909</span>&#125;,</span><br><span class="line">    (<span class="string">&#x27;毛利率&#x27;</span>, <span class="string">&#x27;max&#x27;</span>): &#123;(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>): <span class="number">0.122</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>): <span class="number">0.1071</span>&#125;,</span><br><span class="line">    (<span class="string">&#x27;毛利率&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>): &#123;(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>): <span class="number">0.0841684210526316</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>): <span class="number">0.098475</span>&#125;,</span><br><span class="line">    (<span class="string">&#x27;毛利率&#x27;</span>, <span class="string">&#x27;median&#x27;</span>): &#123;(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>): <span class="number">0.0827</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>): <span class="number">0.0991</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data)</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.apply(<span class="keyword">lambda</span> x:x.<span class="built_in">map</span>(<span class="string">&quot;&#123;:,.2%&#125;&quot;</span>.<span class="built_in">format</span>) <span class="keyword">if</span> x.name[<span class="number">0</span>] == <span class="string">&quot;毛利率&quot;</span> <span class="keyword">else</span> x)</span><br></pre></td></tr></table></figure><hr><h2 id="将-DataFrame-数据转为一行"><a href="#将-DataFrame-数据转为一行" class="headerlink" title="将 DataFrame 数据转为一行"></a><a href="https://gairuo.com/m/pandas-converts-dataframe-into-row">将 DataFrame 数据转为一行</a></h2><blockquote><p>题目：一个 DataFrame 结构的数据转为一行，即将二维的数据展开</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;a3&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>],</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: [<span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c   a   b   c   a   b   c</span></span><br><span class="line"><span class="string">0  a1  11  44  a2  22  55  a3  33  66</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cols = df.stack().index.get_level_values(<span class="number">1</span>)</span><br><span class="line">values = df.stack().values</span><br><span class="line"></span><br><span class="line">pd.DataFrame([values],columns=cols)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方解法</span></span><br><span class="line">df.stack().to_frame().droplevel(<span class="number">0</span>).T</span><br></pre></td></tr></table></figure><hr><h2 id="计算不同商品销售额日环比"><a href="#计算不同商品销售额日环比" class="headerlink" title="计算不同商品销售额日环比"></a><a href="https://gairuo.com/m/pandas-sales-ring-ratio-day">计算不同商品销售额日环比</a></h2><blockquote><p>题目：需要按类型先进行分组，在分组内按日期求得当前日期对比前一日期的变化比例</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">时间类型销售额</span></span><br><span class="line"><span class="string">2021/10/26A13.34827619</span></span><br><span class="line"><span class="string">2021/10/26B86.92582545</span></span><br><span class="line"><span class="string">2021/10/26C69.955569</span></span><br><span class="line"><span class="string">2021/10/27A79.96022902</span></span><br><span class="line"><span class="string">2021/10/27B83.94702123</span></span><br><span class="line"><span class="string">2021/10/28A70.55949574</span></span><br><span class="line"><span class="string">2021/10/28B40.0521712</span></span><br><span class="line"><span class="string">2021/10/28C16.17825062</span></span><br><span class="line"><span class="string">2021/10/29A12.8097718</span></span><br><span class="line"><span class="string">2021/10/30A17.12582533</span></span><br><span class="line"><span class="string">2021/10/30C91.12357503</span></span><br><span class="line"><span class="string">2021/10/31A5.909534462</span></span><br><span class="line"><span class="string">2021/10/31B78.56672937</span></span><br><span class="line"><span class="string">2021/10/31C54.02725342</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_table(StringIO(data))</span><br></pre></td></tr></table></figure><blockquote><p>解法：<code>freq</code> 参数用于指定用于计算时序数据的频率</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.assign(环比 = </span><br><span class="line">        df.astype(&#123;<span class="string">&quot;时间&quot;</span>: <span class="string">&quot;datetime64[ns]&quot;</span>&#125;)</span><br><span class="line">        .set_index(<span class="string">&quot;时间&quot;</span>)</span><br><span class="line">        .groupby(<span class="string">&quot;类型&quot;</span>)[<span class="string">&quot;销售额&quot;</span>]</span><br><span class="line">        .transform(<span class="keyword">lambda</span> x: x.pct_change(freq=<span class="string">&quot;D&quot;</span>))</span><br><span class="line">        .reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="将相同表头的-DataFrame-合并到一起"><a href="#将相同表头的-DataFrame-合并到一起" class="headerlink" title="将相同表头的 DataFrame 合并到一起"></a><a href="https://gairuo.com/m/pandas-merges-dataframes-same-header">将相同表头的 DataFrame 合并到一起</a></h2><blockquote><p>题目：在一批 DataFrame 中将有相同表头（列名）的 DataFrame 合并到一起</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">12</span>],<span class="string">&#x27;d&#x27;</span>:[<span class="number">35</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;b&#x27;</span>:[<span class="number">13</span>]&#125;)</span><br><span class="line">df3 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">25</span>],<span class="string">&#x27;d&#x27;</span>:[<span class="number">35</span>]&#125;)</span><br><span class="line">df4 = pd.DataFrame(&#123;<span class="string">&#x27;b&#x27;</span>:[<span class="number">28</span>]&#125;)</span><br><span class="line"></span><br><span class="line">dflist = [df1, df2, df3, df4]</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.assign(col = df.data.<span class="built_in">map</span>(<span class="built_in">tuple</span>))</span><br><span class="line">    .groupby(<span class="string">&#x27;col&#x27;</span>)</span><br><span class="line">    .data</span><br><span class="line">    .agg(<span class="built_in">list</span>)</span><br><span class="line">    .apply(pd.concat)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="根据指定列按列合并目录中的-Excel"><a href="#根据指定列按列合并目录中的-Excel" class="headerlink" title="根据指定列按列合并目录中的 Excel"></a><a href="https://gairuo.com/m/pandas-merges-excel-catalog">根据指定列按列合并目录中的 Excel</a></h2><blockquote><p>题目：将实现按目录读取所有 Eexcel 文件，用 <code>pd.concat</code> 合并 Dataframe</p><p><a href="https://gairuo.com/file/pic/2020/data_test.zip">数据集下载</a></p><ul><li>读取目录所有 Excel 文件</li><li>按 TM 进行合并，将其他文件的内容追加到原文件的后列</li><li>新文件的列名（字段名）增加文件名的前缀，方便区分</li><li>合并后数据按 TM 排序</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    TM       Z       Q</span></span><br><span class="line"><span class="string">0     1995-01-04 08:00  160.02  4140.0</span></span><br><span class="line"><span class="string">1     1995-01-05 08:00  159.93  4000.0</span></span><br><span class="line"><span class="string">2     1995-01-06 08:00  160.05  4180.0</span></span><br><span class="line"><span class="string">3     1995-01-07 08:00  159.93  4040.0</span></span><br><span class="line"><span class="string">4     1995-01-08 08:00  159.88  3990.0</span></span><br><span class="line"><span class="string"><span class="meta">... </span>               ...     ...     ...</span></span><br><span class="line"><span class="string">2353  1998-04-03 08:00  158.52  2690.0</span></span><br><span class="line"><span class="string">2354  1998-04-04 08:00  158.64  2800.0</span></span><br><span class="line"><span class="string">2355  1998-04-05 08:00  158.72  2870.0</span></span><br><span class="line"><span class="string">2356  1998-04-06 08:00  158.72  2910.0</span></span><br><span class="line"><span class="string">2357  1998-04-07 08:00  158.58  2740.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">files = glob.glob(<span class="string">&quot;data_test/*.xlsx&quot;</span>)</span><br><span class="line"></span><br><span class="line">f = <span class="keyword">lambda</span> x:x.split(<span class="string">r&quot;\\&quot;</span>[-<span class="number">1</span>])[-<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;_&quot;</span></span><br><span class="line"></span><br><span class="line">dfs = [pd.read_excel(file).set_index(<span class="string">&quot;TM&quot;</span>).rename(columns = <span class="keyword">lambda</span> x:f(file)+x) <span class="keyword">for</span> file <span class="keyword">in</span> files]</span><br><span class="line"></span><br><span class="line">pd.concat(dfs,axis=<span class="number">1</span>).sort_index(level=<span class="string">&quot;TM&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                   df1_Z   df1_Q  df2_Z   df2_Q</span></span><br><span class="line"><span class="string">TM</span></span><br><span class="line"><span class="string">1995-01-04 08:00  160.02  4140.0  39.59  5020.0</span></span><br><span class="line"><span class="string">1995-01-05 08:00  159.93  4000.0  39.67  5160.0</span></span><br><span class="line"><span class="string">1995-01-06 08:00  160.05  4180.0  39.93  5600.0</span></span><br><span class="line"><span class="string">1995-01-07 08:00  159.93  4040.0  40.00  5740.0</span></span><br><span class="line"><span class="string">1995-01-08 08:00  159.88  3990.0  39.98  5700.0</span></span><br><span class="line"><span class="string">1995-01-09 08:00  159.83  3930.0  40.04  5800.0</span></span><br><span class="line"><span class="string">1995-01-10 08:00  159.78  3880.0  39.83  5440.0</span></span><br><span class="line"><span class="string">1995-01-10 09:30     NaN     NaN  39.93  5640.0</span></span><br><span class="line"><span class="string">1995-01-10 14:18  159.82  3920.0    NaN     NaN</span></span><br><span class="line"><span class="string">1995-01-11 08:00  159.55  3640.0  39.84  5450.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><hr><h2 id="将连接字符串转为虚拟变量"><a href="#将连接字符串转为虚拟变量" class="headerlink" title="将连接字符串转为虚拟变量"></a><a href="https://gairuo.com/m/pandas-string-dummy-variables">将连接字符串转为虚拟变量</a></h2><blockquote><p>题目：需求期望将vote_code中的变量转为列，值为对应如果包含则为 1，否则为 0</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">投票区  vote_code</span></span><br><span class="line"><span class="string">A选区   S5.S17.S6</span></span><br><span class="line"><span class="string">B选区       S6.S9</span></span><br><span class="line"><span class="string">C选区  S21.S5.S17</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(StringIO(data), sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   投票区   vote_code  S17  S21  S5  S6  S9</span></span><br><span class="line"><span class="string">0  A选区   S5.S17.S6    1    0   1   1   0</span></span><br><span class="line"><span class="string">1  B选区       S6.S9    0    0   0   1   1</span></span><br><span class="line"><span class="string">2  C选区  S21.S5.S17    1    1   1   0   0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.vote_code.<span class="built_in">str</span>.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    .explode()</span><br><span class="line">    .pipe(pd.get_dummies)</span><br><span class="line">    .groupby(level=<span class="number">0</span>)</span><br><span class="line">    .<span class="built_in">sum</span>()</span><br><span class="line">    .pipe(df.join)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="将列表转为以字符为键的字典"><a href="#将列表转为以字符为键的字典" class="headerlink" title="将列表转为以字符为键的字典"></a><a href="https://gairuo.com/m/pandas-list-character-dictionary">将列表转为以字符为键的字典</a></h2><blockquote><p>题目：键是前边的字母，值是字母后边的数字，如果有多个字母则是一个列表</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m = [<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="string">&#x27;d&#x27;</span>,<span class="number">67</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: [<span class="number">13</span>, <span class="number">14</span>], <span class="string">&#x27;d&#x27;</span>: <span class="number">67</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;x&quot;</span>: m&#125;)</span><br><span class="line"></span><br><span class="line">(</span><br><span class="line">    df.assign(y=df.x.where(df.x.<span class="built_in">str</span>.isalpha()))</span><br><span class="line">    .assign(z=<span class="keyword">lambda</span> x: x.y.ffill())</span><br><span class="line">    .query(<span class="string">&quot;x!=z&quot;</span>)</span><br><span class="line">    .groupby(<span class="string">&quot;z&quot;</span>)</span><br><span class="line">    .x.agg(<span class="keyword">lambda</span> x: <span class="built_in">list</span>(x) <span class="keyword">if</span> <span class="built_in">len</span>(x) &gt; <span class="number">1</span> <span class="keyword">else</span> x)</span><br><span class="line">    .to_dict()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="缺失值填充为分组的平均值"><a href="#缺失值填充为分组的平均值" class="headerlink" title="缺失值填充为分组的平均值"></a><a href="https://gairuo.com/m/pandas-missing-values-filled-mean-group">缺失值填充为分组的平均值</a></h2><blockquote><p>题目：将这两个缺失值按其所在组的平均值进行填充</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">&#x27;https://gairuo.com/file/data/team.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建缺失值</span></span><br><span class="line"><span class="comment"># 创建缺失值</span></span><br><span class="line">df = df.head(<span class="number">10</span>).loc[:,<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;Q1&#x27;</span>]</span><br><span class="line">df.loc[(<span class="number">1</span>, <span class="number">2</span>), <span class="string">&#x27;Q1&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">df</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 个人解法</span></span><br><span class="line">gb = df.groupby(<span class="string">&quot;team&quot;</span>).agg(&#123;<span class="string">&quot;Q1&quot;</span>:<span class="string">&quot;mean&quot;</span>&#125;)</span><br><span class="line">df.set_index(<span class="string">&#x27;team&#x27;</span>).fillna(gb).reset_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方解法1</span></span><br><span class="line">df.apply(<span class="keyword">lambda</span> x:x.fillna(df.groupby(<span class="string">&#x27;team&#x27;</span>).agg(&#123;<span class="string">&quot;Q1&quot;</span>:<span class="string">&quot;mean&quot;</span>&#125;).loc[x[<span class="string">&quot;team&quot;</span>]]),axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方解法2</span></span><br><span class="line">mapping = df.groupby(<span class="string">&#x27;team&#x27;</span>).Q1.transform(<span class="string">&quot;mean&quot;</span>)</span><br><span class="line">df.assign(Q1 = df.Q1.mask(df.Q1.isna(),mapping))</span><br></pre></td></tr></table></figure><hr><h2 id="根据树状文本解析其上级"><a href="#根据树状文本解析其上级" class="headerlink" title="根据树状文本解析其上级"></a><a href="https://gairuo.com/m/pandas-parses-parent-tree-text">根据树状文本解析其上级</a></h2><blockquote><p>题目</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">class_</span></span><br><span class="line"><span class="string">A</span></span><br><span class="line"><span class="string">——B1</span></span><br><span class="line"><span class="string">——B2</span></span><br><span class="line"><span class="string">————C1</span></span><br><span class="line"><span class="string">——B3</span></span><br><span class="line"><span class="string">————C2</span></span><br><span class="line"><span class="string">————C3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(StringIO(data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   0     1     2         foo   res</span></span><br><span class="line"><span class="string">0  A  None  None          [A]  None</span></span><br><span class="line"><span class="string">1  A    B1  None      [A, B1]     A</span></span><br><span class="line"><span class="string">2  A    B2  None      [A, B2]     A</span></span><br><span class="line"><span class="string">3  A    B2    C1  [A, B2, C1]    B2</span></span><br><span class="line"><span class="string">4  A    B3  None      [A, B3]     A</span></span><br><span class="line"><span class="string">5  A    B3    C2  [A, B3, C2]    B3</span></span><br><span class="line"><span class="string">6  A    B3    C3  [A, B3, C3]    B3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.class_.<span class="built_in">str</span>.split(<span class="string">&#x27;——&#x27;</span>, expand=<span class="literal">True</span>)</span><br><span class="line">    .replace(&#123;<span class="string">&#x27;&#x27;</span>: <span class="literal">None</span>&#125;)</span><br><span class="line">    .apply(<span class="keyword">lambda</span> x: x <span class="keyword">if</span> x.name == <span class="number">2</span> <span class="keyword">else</span> x.ffill())</span><br><span class="line">    .assign(foo=<span class="keyword">lambda</span> x: x.apply(<span class="keyword">lambda</span> s: s.dropna().to_list(), axis=<span class="number">1</span>))</span><br><span class="line">    .assign(res=<span class="keyword">lambda</span> x: x.foo.apply(<span class="keyword">lambda</span> s: s[-<span class="number">2</span>] <span class="keyword">if</span> <span class="built_in">len</span>(s)&gt;<span class="number">1</span> <span class="keyword">else</span> <span class="literal">None</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="筛选日期连续的数据行"><a href="#筛选日期连续的数据行" class="headerlink" title="筛选日期连续的数据行"></a><a href="https://gairuo.com/m/pandas-filters-consecutive-dates">筛选日期连续的数据行</a></h2><blockquote><p>题目：筛选出不分位置日期连续的行</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a,b,c</span></span><br><span class="line"><span class="string">2022/9/23,2022/9/24,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/27,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/21,2022/9/22,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/22,2022/9/21</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/24,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/22,2022/9/21,2022/9/25</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/21,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/21,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/24,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/23,2022/9/25,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/27,2022/9/26,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/24,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/24,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/21,2022/9/26,2022/9/22</span></span><br><span class="line"><span class="string">2022/9/24,2022/9/25,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/21,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/24,2022/9/26,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/22,2022/9/21</span></span><br><span class="line"><span class="string">2022/9/22,2022/9/27,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/27,2022/9/21,2022/9/25</span></span><br><span class="line"><span class="string">2022/9/27,2022/9/25,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/24,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/26,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/21,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/23,2022/9/25,2022/9/26</span></span><br><span class="line"><span class="string">2022/9/22,2022/9/26,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/27,2022/9/21</span></span><br><span class="line"><span class="string">2022/9/25,2022/9/21,2022/9/24</span></span><br><span class="line"><span class="string">2022/9/26,2022/9/21,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/22,2022/9/21,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/27,2022/9/26,2022/9/23</span></span><br><span class="line"><span class="string">2022/9/22,2022/9/26,2022/9/27</span></span><br><span class="line"><span class="string">2022/9/22,2022/9/27,2022/9/26</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(StringIO(data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            a          b          c</span></span><br><span class="line"><span class="string">11  2022/9/25  2022/9/24  2022/9/26</span></span><br><span class="line"><span class="string">14  2022/9/24  2022/9/25  2022/9/26</span></span><br><span class="line"><span class="string">20  2022/9/27  2022/9/25  2022/9/26</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">ser: pd.Series</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        ser.astype(<span class="string">&quot;datetime64[ns]&quot;</span>).sort_values().diff().dropna().eq(pd.Timedelta(<span class="string">&quot;1days&quot;</span>)).<span class="built_in">all</span>()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">df[df.apply(func, axis=<span class="number">1</span>)]</span><br></pre></td></tr></table></figure><hr><h2 id="根据值在其他列中出现的次数指定列值"><a href="#根据值在其他列中出现的次数指定列值" class="headerlink" title="根据值在其他列中出现的次数指定列值"></a><a href="https://gairuo.com/m/pandas-column-depending-times-other">根据值在其他列中出现的次数指定列值</a></h2><blockquote><p>题目：增加一个名为“Temperature”的新列，当 Container 第一次出现Event为“Clean”时，它的值为4，而所有后续的“Clean“事件的值为3。Dry时的值总是1</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Container Event</span></span><br><span class="line"><span class="string">A         Clean</span></span><br><span class="line"><span class="string">B         Dry</span></span><br><span class="line"><span class="string">A         Clean</span></span><br><span class="line"><span class="string">A         Dry</span></span><br><span class="line"><span class="string">B         Clean</span></span><br><span class="line"><span class="string">C         Clean</span></span><br><span class="line"><span class="string">C         Clean</span></span><br><span class="line"><span class="string">C         Clean</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(io.StringIO(data), sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Container  Event  Temperature</span></span><br><span class="line"><span class="string">A          Clean  4</span></span><br><span class="line"><span class="string">B          Dry    1</span></span><br><span class="line"><span class="string">A          Clean  3</span></span><br><span class="line"><span class="string">A          Dry    1</span></span><br><span class="line"><span class="string">B          Clean  4</span></span><br><span class="line"><span class="string">C          Clean  4</span></span><br><span class="line"><span class="string">C          Clean  3</span></span><br><span class="line"><span class="string">C          Clean  3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官方解法: 使用np.select</span></span><br><span class="line">cond1 = ~df.duplicated()</span><br><span class="line">cond2 = df[<span class="string">&#x27;Event&#x27;</span>].eq(<span class="string">&#x27;Clean&#x27;</span>)</span><br><span class="line">cond3 = df[<span class="string">&#x27;Event&#x27;</span>].eq(<span class="string">&#x27;Dry&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;Temperature&#x27;</span>] = np.select([cond1 &amp; cond2, cond2, cond3], [<span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 个人解法</span></span><br><span class="line">df.assign(</span><br><span class="line">    Temperature=df.groupby(<span class="string">&quot;Container&quot;</span>)[<span class="string">&quot;Event&quot;</span>]</span><br><span class="line">    .transform(<span class="keyword">lambda</span> x:x.mask(x==<span class="string">&quot;Dry&quot;</span>,<span class="number">1</span>).mask(x != <span class="string">&quot;Dry&quot;</span>,<span class="number">4</span>-x.duplicated()))</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="将时间区间展开为年月两列"><a href="#将时间区间展开为年月两列" class="headerlink" title="将时间区间展开为年月两列"></a><a href="https://gairuo.com/m/pandas-expands-interval-month-year">将时间区间展开为年月两列</a></h2><blockquote><p>题目：将数据按起始日期到结束日期展开，增加年和月列</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">合同编号    起始日期    结束日期</span></span><br><span class="line"><span class="string">BH001   2023-02-20  2024-02-19</span></span><br><span class="line"><span class="string">BH002   2023-04-01  2026-03-31</span></span><br><span class="line"><span class="string">BH003   2022-04-10  2023-04-09</span></span><br><span class="line"><span class="string">BH004   2023-03-01  2024-09-30</span></span><br><span class="line"><span class="string">BH005   2023-02-01  2026-01-31</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(StringIO(data), sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">合同编号    年   月</span></span><br><span class="line"><span class="string">BH001   2023    2</span></span><br><span class="line"><span class="string">BH001   2023    3</span></span><br><span class="line"><span class="string">BH001   2023    4</span></span><br><span class="line"><span class="string">BH001   2023    5</span></span><br><span class="line"><span class="string">BH001   2023    6</span></span><br><span class="line"><span class="string">BH001   2023    7</span></span><br><span class="line"><span class="string">BH001   2023    8</span></span><br><span class="line"><span class="string">BH001   2023    9</span></span><br><span class="line"><span class="string">BH001   2023    10</span></span><br><span class="line"><span class="string">BH001   2023    11</span></span><br><span class="line"><span class="string">BH001   2023    12</span></span><br><span class="line"><span class="string">BH001   2024    1</span></span><br><span class="line"><span class="string">BH001   2024    2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.assign(date=df.apply(<span class="keyword">lambda</span> x: pd.date_range(x[<span class="string">&quot;起始日期&quot;</span>], x[<span class="string">&quot;结束日期&quot;</span>]), axis=<span class="number">1</span>))</span><br><span class="line">    .explode(<span class="string">&quot;date&quot;</span>)</span><br><span class="line">    .assign(年=<span class="keyword">lambda</span> x: x[<span class="string">&quot;date&quot;</span>].dt.year, 月=<span class="keyword">lambda</span> x: x[<span class="string">&quot;date&quot;</span>].dt.month)</span><br><span class="line">    .loc[:, [<span class="string">&quot;合同编号&quot;</span>, <span class="string">&quot;年&quot;</span>, <span class="string">&quot;月&quot;</span>]]</span><br><span class="line">    .drop_duplicates()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> Pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pandas习题-盖若(入门/基础部分)</title>
      <link href="/posts/c02b5fa5.html"/>
      <url>/posts/c02b5fa5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Pandas习题-盖若-入门-基础部分"><a href="#Pandas习题-盖若-入门-基础部分" class="headerlink" title="Pandas习题 - 盖若(入门&#x2F;基础部分)"></a>Pandas习题 - 盖若(入门&#x2F;基础部分)</h1><h2 id="解析开始结束年份和最大间隔"><a href="#解析开始结束年份和最大间隔" class="headerlink" title="解析开始结束年份和最大间隔"></a><a href="https://gairuo.com/m/pandas-parsing-year-gap">解析开始结束年份和最大间隔</a></h2><blockquote><p>题目：在一个列表形式的数据中，来解析开始和结束年份以及它们的最大年份间隔</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Years</span></span><br><span class="line"><span class="string">[1990,1991,1995,2000,2001,2006]</span></span><br><span class="line"><span class="string">[1990,1990]</span></span><br><span class="line"><span class="string">[1980,1981,1990,1995]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(io.StringIO(data), sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需求结果</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   from_year  to_year  largest_gap</span></span><br><span class="line"><span class="string">0       1990     2006            5</span></span><br><span class="line"><span class="string">1       1990     1990            0</span></span><br><span class="line"><span class="string">2       1980     1995            9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.Years.<span class="built_in">map</span>(<span class="built_in">eval</span>).explode()</span><br><span class="line">    .groupby(level=<span class="number">0</span>)</span><br><span class="line">    .agg(from_year=<span class="string">&quot;min&quot;</span>,to_year=<span class="string">&quot;max&quot;</span>,largest_gap=<span class="keyword">lambda</span> x:x.diff().<span class="built_in">max</span>())</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="openpyxl完成Excel指定单元格样式"><a href="#openpyxl完成Excel指定单元格样式" class="headerlink" title="openpyxl完成Excel指定单元格样式"></a><a href="https://gairuo.com/m/pandas-openpyxl-excel-cell-styles">openpyxl完成Excel指定单元格样式</a></h2><blockquote><p>题目：将 <code>&#39;B5&#39;:&#39;E10&#39;</code> 范围的单元格设置为绿色背景、红色字体、14 号大小</p></blockquote><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Font, PatternFill, colors</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 Excel 文件</span></span><br><span class="line">workbook = load_workbook(<span class="string">&#x27;team.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择工作表</span></span><br><span class="line">sheet = workbook.active</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选取单元格范围</span></span><br><span class="line">df = pd.DataFrame(sheet[<span class="string">&#x27;B5&#x27;</span>:<span class="string">&#x27;E10&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify_style</span>(<span class="params">cell</span>):</span><br><span class="line">    <span class="comment"># 设置样式</span></span><br><span class="line">    bold_font = Font(size=<span class="number">14</span>, bold=<span class="literal">True</span>, color=<span class="string">&#x27;FF0000&#x27;</span>)</span><br><span class="line">    yellow_fill = PatternFill(start_color=<span class="string">&#x27;00FF00&#x27;</span>,</span><br><span class="line">                          end_color=<span class="string">&#x27;00FF00&#x27;</span>,</span><br><span class="line">                          fill_type=<span class="string">&#x27;solid&#x27;</span>)</span><br><span class="line">    <span class="comment"># 修改样式</span></span><br><span class="line">    cell.font = bold_font</span><br><span class="line">    cell.fill = yellow_fill</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用修改样式</span></span><br><span class="line">df.<span class="built_in">map</span>(modify_style)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存修改后的 Excel 文件</span></span><br><span class="line">workbook.save(<span class="string">&#x27;team_formatted.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭 Excel 文件</span></span><br><span class="line">workbook.close()</span><br></pre></td></tr></table></figure><hr><h2 id="两个不同结构DataFrame相加合并"><a href="#两个不同结构DataFrame相加合并" class="headerlink" title="两个不同结构DataFrame相加合并"></a><a href="https://gairuo.com/m/pandas-addition-dataframes">两个不同结构DataFrame相加合并</a></h2><blockquote><p>题目：将两个 DataFrame 合并，共有的索引标签 c2 行的值相加，非共有的 c1、c3 保持原值</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>], <span class="string">&#x27;b&#x27;</span>:[<span class="number">3</span>,<span class="number">4</span>]&#125;, index=[<span class="string">&#x27;c1&#x27;</span>,<span class="string">&#x27;c2&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>], <span class="string">&#x27;b&#x27;</span>:[<span class="number">3</span>,<span class="number">4</span>]&#125;, index=[<span class="string">&#x27;c2&#x27;</span>,<span class="string">&#x27;c3&#x27;</span>])</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><ol><li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.add(df2,fill_value=<span class="number">0</span>).astype(<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure></li><li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(df1 + df2).fillna(df1).fillna(df2).astype(<span class="built_in">int</span>)</span><br><span class="line">   </span><br><span class="line"><span class="comment"># 类似方法</span></span><br><span class="line">(df1 + df2).combine_first(df1).combine_first(df2).astype(<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="根据文本数据提取特征"><a href="#根据文本数据提取特征" class="headerlink" title="根据文本数据提取特征"></a><a href="https://gairuo.com/m/pandas-text-extraction-features">根据文本数据提取特征</a></h2><blockquote><p>题目：在数据后边增加一些列，每个字母为一列，值为本行对应字母的数量</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;6R-5A-4G-7R&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;2A-4G-3A&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;8G&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;1R-9A&#x27;</span>]</span><br><span class="line">                  &#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">             a</span></span><br><span class="line"><span class="string">0  6R-5A-4G-7R</span></span><br><span class="line"><span class="string">1     2A-4G-3A</span></span><br><span class="line"><span class="string">2           8G</span></span><br><span class="line"><span class="string">3        1R-9A</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">             a   R  A  G</span></span><br><span class="line"><span class="string">0  6R-5A-4G-7R  13  5  4</span></span><br><span class="line"><span class="string">1     2A-4G-3A   0  5  4</span></span><br><span class="line"><span class="string">2           8G   0  0  8</span></span><br><span class="line"><span class="string">3        1R-9A   1  9  0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法：利用<code>Counter</code>返回字符串的字符和出现次数的字典</p></blockquote><blockquote><p>手动实现<code>Counter</code>效果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">My_Counter</span>(<span class="params">letters:<span class="built_in">str</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line"> letter_dict = &#123;&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">for</span> letter <span class="keyword">in</span> letters:</span><br><span class="line">     letter_dict[letter] = (letter_dict[letter] + <span class="number">1</span> <span class="keyword">if</span> letter <span class="keyword">in</span> letter_dict <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line">     </span><br><span class="line"> <span class="keyword">return</span> letter_dict</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">ser = (</span><br><span class="line">    df.a.<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x.split(<span class="string">&quot;-&quot;</span>))</span><br><span class="line">    .<span class="built_in">map</span>(<span class="keyword">lambda</span> i:<span class="string">&quot;&quot;</span>.join([j[<span class="number">1</span>] * <span class="built_in">int</span>(j[<span class="number">0</span>]) <span class="keyword">for</span> j <span class="keyword">in</span> i]))</span><br><span class="line">    .<span class="built_in">map</span>(Counter)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(ser.to_list()).fillna(<span class="number">0</span>).astype(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">df.merge(df2,left_index=<span class="literal">True</span>,right_index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><hr><h2 id="按列拆分导出Excel"><a href="#按列拆分导出Excel" class="headerlink" title="按列拆分导出Excel"></a><a href="https://gairuo.com/m/pandas-split-column-export-excel">按列拆分导出Excel</a></h2><blockquote><p>题目：按列拆分Excel，批量将一个Excel拆分多个Excel</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;https://gairuo.com/file/data/team.xlsx&#x27;</span>)</span><br><span class="line">df = df.head()</span><br><span class="line">df.columns = [<span class="string">&#x27;name&#x27;</span>] + [<span class="string">&#x27;foo&#x27;</span>]*<span class="number">2</span> + [<span class="string">&#x27;bar&#x27;</span>]*<span class="number">3</span></span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    name  foo  foo  bar  bar  bar</span></span><br><span class="line"><span class="string">0  Liver    E   89   21   24   64</span></span><br><span class="line"><span class="string">1   Arry    C   36   37   37   57</span></span><br><span class="line"><span class="string">2    Ack    A   57   60   18   84</span></span><br><span class="line"><span class="string">3  Eorge    C   93   96   71   78</span></span><br><span class="line"><span class="string">4    Oah    D   65   49   61   86</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法：因groupby中axis&#x3D;1已弃用，故使用T方法进行转置</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.set_index(<span class="string">&#x27;name&#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">df.T.groupby(level=<span class="number">0</span>).apply(<span class="keyword">lambda</span> x:x.T.to_excel(<span class="string">f&quot;<span class="subst">&#123;x.name&#125;</span>.xlsx&quot;</span>))</span><br></pre></td></tr></table></figure><hr><h2 id="对每个工作簿增加工作簿名称的列"><a href="#对每个工作簿增加工作簿名称的列" class="headerlink" title="对每个工作簿增加工作簿名称的列"></a><a href="https://gairuo.com/m/pandas-column-workbook-name-excel">对每个工作簿增加工作簿名称的列</a></h2><blockquote><p>题目：在工作簿的每个工作表数据内都插入一列，列的内容为对应工作的名称</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs = pd.read_excel(<span class="string">&quot;data/company.xlsx&quot;</span>,sheet_name=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> pd.ExcelWriter(<span class="string">&quot;data/company.xlsx&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> sht_name,df <span class="keyword">in</span> dfs.items():</span><br><span class="line">        df.assign(company = sht_name).to_excel(file,sheet_name=sht_name,index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><hr><h2 id="标记按月连续变化趋势"><a href="#标记按月连续变化趋势" class="headerlink" title="标记按月连续变化趋势"></a><a href="https://gairuo.com/m/pandas-trend-continuous-change">标记按月连续变化趋势</a></h2><blockquote><p>题目：要以6月为基础，看每个行 6 月前的数据相对 6 月是否有上升、下降或持平，还要说明持续时间</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">4096</span>)</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randint(<span class="number">0</span>, <span class="number">100</span>, (<span class="number">8</span>, <span class="number">6</span>)),</span><br><span class="line">                  columns=pd.array([*<span class="string">&#x27;123456&#x27;</span>])+<span class="string">&#x27;月&#x27;</span></span><br><span class="line">                 )</span><br><span class="line"></span><br><span class="line">df.iloc[<span class="number">4</span>, <span class="number">1</span>:] = df.iloc[<span class="number">4</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果需求</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   1月    2月    3月    4月    5月   6月     连续增减</span></span><br><span class="line"><span class="string">0    36    40    89    40    90    88  连续1个月降低</span></span><br><span class="line"><span class="string">1    23    78    70    62    30    17  连续4个月降低</span></span><br><span class="line"><span class="string">2    23    42    68    49    87    96  连续2个月增长</span></span><br><span class="line"><span class="string">3    66    75    45    96    61    20  连续2个月降低</span></span><br><span class="line"><span class="string">4    22    71    71    71    71    71  连续4个月持平</span></span><br><span class="line"><span class="string">5     2    41    64    72    89    96  连续5个月增长</span></span><br><span class="line"><span class="string">6    35    93    45    42    75    18  连续1个月降低</span></span><br><span class="line"><span class="string">7    99    83     1    50    85    64  连续1个月降低</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">ser:pd.Series</span>):</span><br><span class="line">    ser_diff = ser.diff().<span class="built_in">map</span>(np.sign)</span><br><span class="line">    status = &#123;<span class="number">0</span>:<span class="string">&quot;持平&quot;</span>,<span class="number">1</span>:<span class="string">&quot;增长&quot;</span>,-<span class="number">1</span>:<span class="string">&quot;降低&quot;</span>&#125;[ser_diff.iloc[-<span class="number">1</span>]]</span><br><span class="line">    cnt =  (ser_diff == ser_diff.iloc[-<span class="number">1</span>])[::-<span class="number">1</span>].cumprod().<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;连续<span class="subst">&#123;cnt&#125;</span>个月<span class="subst">&#123;status&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">df.assign(连续增减 = df.apply(f,axis=<span class="number">1</span>))</span><br></pre></td></tr></table></figure><hr><h2 id="增加当前行与上行之和的新列"><a href="#增加当前行与上行之和的新列" class="headerlink" title="增加当前行与上行之和的新列"></a><a href="https://gairuo.com/m/pandas-new-column-sum-previous-row">增加当前行与上行之和的新列</a></h2><blockquote><p>题目：增加一个 C 列。C 列的索引 0 取 B 列的对应值，其他值取 C 列自己上一个值与对应 A 列值的和</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random.seed(<span class="number">666</span>)</span><br><span class="line">rng = <span class="built_in">range</span>(<span class="number">100</span>, <span class="number">1100</span>, <span class="number">100</span>)</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: [<span class="built_in">round</span>(random.random(), <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> rng],</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: rng</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      A     B       C</span></span><br><span class="line"><span class="string">0  0.46   100  100.00</span></span><br><span class="line"><span class="string">1  0.90   200  100.90</span></span><br><span class="line"><span class="string">2  0.43   300  101.33</span></span><br><span class="line"><span class="string">3  0.50   400  101.83</span></span><br><span class="line"><span class="string">4  0.81   500  102.64</span></span><br><span class="line"><span class="string">5  0.55   600  103.19</span></span><br><span class="line"><span class="string">6  0.71   700  103.90</span></span><br><span class="line"><span class="string">7  0.12   800  104.02</span></span><br><span class="line"><span class="string">8  0.81   900  104.83</span></span><br><span class="line"><span class="string">9  0.39  1000  105.22</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.assign(C = df.A.mask(df.index == <span class="number">0</span>,df.B).cumsum())</span><br></pre></td></tr></table></figure><hr><h2 id="筛选日期前后连续的行"><a href="#筛选日期前后连续的行" class="headerlink" title="筛选日期前后连续的行"></a><a href="https://gairuo.com/m/pandas-finds-consecutive-dates-row">筛选日期前后连续的行</a></h2><blockquote><p>题目：日期的连续要判断它们的间隔是一天</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">2022/9/23</span></span><br><span class="line"><span class="string">2022/10/24</span></span><br><span class="line"><span class="string">2022/9/21</span></span><br><span class="line"><span class="string">2022/9/22</span></span><br><span class="line"><span class="string">2022/9/23</span></span><br><span class="line"><span class="string">2022/9/25</span></span><br><span class="line"><span class="string">2022/9/26</span></span><br><span class="line"><span class="string">2022/9/26</span></span><br><span class="line"><span class="string">2022/11/2</span></span><br><span class="line"><span class="string">2022/11/3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(StringIO(data))</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = df.astype(<span class="string">&quot;datetime64[ns]&quot;</span>)</span><br><span class="line"></span><br><span class="line">df[(df.a.diff() == pd.Timedelta(<span class="string">&quot;1d&quot;</span>)) | (df.a.diff(-<span class="number">1</span>).<span class="built_in">abs</span>() == pd.Timedelta(<span class="string">&quot;1d&quot;</span>))]</span><br></pre></td></tr></table></figure><hr><h2 id="筛选出指定样本数据"><a href="#筛选出指定样本数据" class="headerlink" title="筛选出指定样本数据"></a><a href="https://gairuo.com/m/pandas-selects-specified-sample">筛选出指定样本数据</a></h2><blockquote><p>题目：需要将数据集中的符合样本，数据的内容全部筛选出来</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">col = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">col</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">4</span></span><br><span class="line"><span class="string">7</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">6</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">4</span></span><br><span class="line"><span class="string">7</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">5</span></span><br><span class="line"><span class="string">7</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">4</span></span><br><span class="line"><span class="string">7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 样本数据</span></span><br><span class="line">data = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读入数据</span></span><br><span class="line">df = pd.read_csv(io.StringIO(col))</span><br></pre></td></tr></table></figure><blockquote><p>解法：按照窗口函数的值是否等于样本数据，窗口函数内的各个对象为DataFrame</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">idx_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> roller <span class="keyword">in</span> df.rolling(window=<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">if</span> roller.col.to_list() == data:</span><br><span class="line">        idx_list.extend(roller.index)</span><br><span class="line">    </span><br><span class="line">df.reindex(index = idx_list)</span><br></pre></td></tr></table></figure><hr><h2 id="实现类似-SQL-row-number分组行号"><a href="#实现类似-SQL-row-number分组行号" class="headerlink" title="实现类似 SQL row_number分组行号"></a><a href="https://gairuo.com/m/pandas-sql-group-row-number">实现类似 SQL row_number分组行号</a></h2><blockquote><p>题目：a 列为分组，b 列为值，需求为增加一个 row_number 列，显示按 a 分组的行号</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random.seed(<span class="number">666</span>)</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">                   <span class="string">&#x27;b&#x27;</span>: random.choices(<span class="built_in">range</span>(<span class="number">10</span>), k=<span class="number">8</span>)</span><br><span class="line">                  &#125;)</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解法1</span></span><br><span class="line">(</span><br><span class="line">    df.groupby(<span class="string">&#x27;a&#x27;</span>)[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">    .transform(<span class="string">&#x27;rank&#x27;</span>, method=<span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">    .astype(<span class="built_in">int</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解法2</span></span><br><span class="line">df.assign(rk = df.groupby(<span class="string">&quot;a&quot;</span>).cumcount() + <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="将列表中同符号的数据重新排序"><a href="#将列表中同符号的数据重新排序" class="headerlink" title="将列表中同符号的数据重新排序"></a><a href="https://gairuo.com/m/pandas-same-sign-list-order">将列表中同符号的数据重新排序</a></h2><blockquote><p>题目：在保证正负值段的整体顺序不变的情况下，在此段内容按绝对值从小到大排序</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">l = [-<span class="number">8</span>,-<span class="number">7</span>, -<span class="number">2</span>, -<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, -<span class="number">3</span> ,-<span class="number">1</span> ,-<span class="number">2</span> ,<span class="number">9</span> ,<span class="number">10</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line">[-<span class="number">1</span>, -<span class="number">2</span>, -<span class="number">7</span>, -<span class="number">8</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>, -<span class="number">2</span>, -<span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;num&quot;</span>:l&#125;)</span><br><span class="line"></span><br><span class="line">ser = df[<span class="string">&quot;num&quot;</span>].<span class="built_in">map</span>(np.sign)</span><br><span class="line"></span><br><span class="line">(</span><br><span class="line">    df.assign(gb=ser.ne(ser.shift()).cumsum())</span><br><span class="line">    .groupby(<span class="string">&quot;gb&quot;</span>)[<span class="string">&quot;num&quot;</span>]</span><br><span class="line">    .apply(<span class="keyword">lambda</span> x:x.sort_values(ascending=<span class="literal">False</span>) <span class="keyword">if</span> x.<span class="built_in">sum</span>() &lt; <span class="number">0</span> <span class="keyword">else</span> x.sort_values()) <span class="comment"># 判断组内是负数组还是正数组来决定排序方向</span></span><br><span class="line">    .to_list()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="按顺序填充缺失值"><a href="#按顺序填充缺失值" class="headerlink" title="按顺序填充缺失值"></a><a href="https://gairuo.com/m/pandas-fill-missing-order">按顺序填充缺失值</a></h2><blockquote><p>题目：按照从上到下的顺序，将 y 列的 3 个有效值填充到 x 列的缺失位上</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;x&#x27;</span>: <span class="built_in">list</span>(<span class="string">&#x27;aabbccdd&#x27;</span>),</span><br><span class="line">                   <span class="string">&#x27;y&#x27;</span>: <span class="built_in">list</span>(<span class="string">&#x27;ABC&#x27;</span>)+<span class="number">5</span>*[np.nan]&#125;)</span><br><span class="line"><span class="comment"># 创造缺失值</span></span><br><span class="line">df.iloc[np.r_[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>], <span class="number">0</span>] = np.nan</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     x    y</span></span><br><span class="line"><span class="string">0    a    A</span></span><br><span class="line"><span class="string">1    a    B</span></span><br><span class="line"><span class="string">2  NaN    C</span></span><br><span class="line"><span class="string">3  NaN  NaN</span></span><br><span class="line"><span class="string">4    c  NaN</span></span><br><span class="line"><span class="string">5  NaN  NaN</span></span><br><span class="line"><span class="string">6    d  NaN</span></span><br><span class="line"><span class="string">7    d  NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解法1:循环填充x列</span></span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">enumerate</span>(df[<span class="string">&quot;x&quot;</span>][df[<span class="string">&quot;x&quot;</span>].isna()].index):</span><br><span class="line">    df.loc[j,<span class="string">&quot;x&quot;</span>] = df[<span class="string">&quot;y&quot;</span>][df[<span class="string">&quot;y&quot;</span>].notna()][i]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 解法2:构建y列非空值的x列空值索引的新Series</span></span><br><span class="line">ser = df[<span class="string">&quot;y&quot;</span>][df[<span class="string">&quot;y&quot;</span>].notna()].set_axis(df[<span class="string">&quot;x&quot;</span>][df[<span class="string">&quot;x&quot;</span>].isna()].index)</span><br><span class="line">df[<span class="string">&quot;x&quot;</span>].fillna(ser)</span><br></pre></td></tr></table></figure><hr><h2 id="统计设备运行天数"><a href="#统计设备运行天数" class="headerlink" title="统计设备运行天数"></a><a href="https://gairuo.com/m/pandas-device-uptime-days-online">统计设备运行天数</a></h2><blockquote><p>题目：1 为运行状态，0 为停机状态。我们需要统计每次运行状态的最后一天及运行的天数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;Date&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;5/29/2025&quot;</span>, <span class="string">&quot;5/31/2025&quot;</span>, <span class="string">&quot;6/1/2025&quot;</span>, <span class="string">&quot;6/2/2025&quot;</span>,</span><br><span class="line">        <span class="string">&quot;6/3/2025&quot;</span>, <span class="string">&quot;6/4/2025&quot;</span>, <span class="string">&quot;6/5/2025&quot;</span>, <span class="string">&quot;6/6/2025&quot;</span>,</span><br><span class="line">        <span class="string">&quot;6/7/2025&quot;</span>, <span class="string">&quot;6/8/2025&quot;</span>, <span class="string">&quot;6/9/2025&quot;</span>, <span class="string">&quot;6/10/2025&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;Status&quot;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line">df[<span class="string">&quot;Date&quot;</span>] = pd.to_datetime(df[<span class="string">&quot;Date&quot;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         Date  Status</span></span><br><span class="line"><span class="string">0  2025-05-29       1</span></span><br><span class="line"><span class="string">1  2025-05-31       1</span></span><br><span class="line"><span class="string">2  2025-06-01       1</span></span><br><span class="line"><span class="string">3  2025-06-02       1</span></span><br><span class="line"><span class="string">4  2025-06-03       0</span></span><br><span class="line"><span class="string">5  2025-06-04       0</span></span><br><span class="line"><span class="string">6  2025-06-05       0</span></span><br><span class="line"><span class="string">7  2025-06-06       1</span></span><br><span class="line"><span class="string">8  2025-06-07       1</span></span><br><span class="line"><span class="string">9  2025-06-08       1</span></span><br><span class="line"><span class="string">10 2025-06-09       1</span></span><br><span class="line"><span class="string">11 2025-06-10       1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    df.assign(gb = df[<span class="string">&quot;Status&quot;</span>].ne(df[<span class="string">&quot;Status&quot;</span>].shift()).cumsum())</span><br><span class="line">    .query(<span class="string">&quot;Status &gt; 0&quot;</span>)</span><br><span class="line">    .groupby(<span class="string">&quot;gb&quot;</span>,as_index=<span class="literal">False</span>)[<span class="string">&quot;Date&quot;</span>]</span><br><span class="line">    .agg(Date = <span class="string">&quot;max&quot;</span>,DaysOnline = <span class="string">&quot;count&quot;</span>)</span><br><span class="line">    .drop(<span class="string">&quot;gb&quot;</span>,axis=<span class="number">1</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h2 id="按活动时间范围合并数据"><a href="#按活动时间范围合并数据" class="headerlink" title="按活动时间范围合并数据"></a><a href="https://gairuo.com/m/pandas-merge-activity-range">按活动时间范围合并数据</a></h2><blockquote><p>题目：在销售表的基础上，将活动表的三个信息增加成为其后的列，当然这个要根据活动的时间范围</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">df_sales = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;销售日期&#x27;</span>:pd.date_range(<span class="string">&#x27;20240101&#x27;</span>, periods=<span class="number">9</span>),</span><br><span class="line">        <span class="string">&#x27;销售额&#x27;</span>:np.random.randint(<span class="number">100</span>, <span class="number">1000</span>, <span class="number">9</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">df_campiagn = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;活动开始日期&#x27;</span>:[pd.to_datetime(<span class="string">&#x27;20240102&#x27;</span>), pd.to_datetime(<span class="string">&#x27;20240105&#x27;</span>)],</span><br><span class="line">    <span class="string">&#x27;活动结束日期&#x27;</span>:[pd.to_datetime(<span class="string">&#x27;20240103&#x27;</span>), pd.to_datetime(<span class="string">&#x27;20240107&#x27;</span>)],</span><br><span class="line">    <span class="string">&#x27;促销描述&#x27;</span>:[<span class="string">&#x27;买一送一&#x27;</span>, <span class="string">&#x27;打8折&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  销售日期  销售额  活动开始日期 活动结束日期  促销描述</span></span><br><span class="line"><span class="string">0 2024-01-01  535        NaT        NaT   NaN</span></span><br><span class="line"><span class="string">1 2024-01-02  237 2024-01-02 2024-01-03  买一送一</span></span><br><span class="line"><span class="string">2 2024-01-03  251 2024-01-02 2024-01-03  买一送一</span></span><br><span class="line"><span class="string">3 2024-01-04  983        NaT        NaT   NaN</span></span><br><span class="line"><span class="string">4 2024-01-05  989 2024-01-05 2024-01-07   打8折</span></span><br><span class="line"><span class="string">5 2024-01-06  999 2024-01-05 2024-01-07   打8折</span></span><br><span class="line"><span class="string">6 2024-01-07  549 2024-01-05 2024-01-07   打8折</span></span><br><span class="line"><span class="string">7 2024-01-08  648        NaT        NaT   NaN</span></span><br><span class="line"><span class="string">8 2024-01-09  236        NaT        NaT   NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> df_sales.iterrows():</span><br><span class="line">    dt = j[<span class="string">&quot;销售日期&quot;</span>]</span><br><span class="line">    df = df_campiagn.query(<span class="string">&quot;(@dt &gt;= 活动开始日期) &amp; (@dt &lt;= 活动结束日期)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(df) &gt; <span class="number">0</span>:</span><br><span class="line">        df_sales.loc[i, <span class="string">&quot;活动开始日期&quot;</span>] = df.iloc[<span class="number">0</span>][<span class="string">&quot;活动开始日期&quot;</span>]</span><br><span class="line">        df_sales.loc[i, <span class="string">&quot;活动结束日期&quot;</span>] = df.iloc[<span class="number">0</span>][<span class="string">&quot;活动结束日期&quot;</span>]</span><br><span class="line">        df_sales.loc[i, <span class="string">&quot;促销描述&quot;</span>] = df.iloc[<span class="number">0</span>][<span class="string">&quot;促销描述&quot;</span>]</span><br></pre></td></tr></table></figure><hr><h2 id="非向量化修改数据"><a href="#非向量化修改数据" class="headerlink" title="非向量化修改数据"></a><a href="https://gairuo.com/m/pandas-non-vectorized-calculation">非向量化修改数据</a></h2><blockquote><p>题目：需要增加一列 c，c 列的计算逻辑是第一行的值为所在行的a+b，第二行及以后的值为当前行的a + 上一行的c</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   a  b   c</span></span><br><span class="line"><span class="string">0  5  3   8</span></span><br><span class="line"><span class="string">1  6  5  14</span></span><br><span class="line"><span class="string">2  7  8  21</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>习题</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> df.iterrows():</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">        df.loc[i,<span class="string">&quot;c&quot;</span>] = df.loc[i,[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>]].<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        df.loc[i,<span class="string">&quot;c&quot;</span>] = df.loc[i-<span class="number">1</span>,<span class="string">&quot;c&quot;</span>] + j.a</span><br></pre></td></tr></table></figure><hr><h2 id="计算实验仪器正常运行周期时长"><a href="#计算实验仪器正常运行周期时长" class="headerlink" title="计算实验仪器正常运行周期时长"></a><a href="https://gairuo.com/m/pandas-normal-period-experimental-instruments">计算实验仪器正常运行周期时长</a></h2><blockquote><p>题目：增加 Delta 列来计算显示 T（触发）和 C（结束）状态之间的时间差，状态 C 之后不经过 T 还可能出现状态 C，我们视 T 之后到第一个 C 之间为一个正常运行周期</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">df=pd.DataFrame(columns=[<span class="string">&#x27;Status&#x27;</span>,<span class="string">&#x27;t&#x27;</span>])</span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;Status&#x27;</span>]=[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">df[<span class="string">&#x27;t&#x27;</span>]= pd.to_datetime([<span class="string">&#x27;2021-06-12 08:39:24.813000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 08:39:24.820000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 08:39:25.210000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 08:39:25.217000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 08:44:28.830000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 10:48:10.293000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 10:48:10.300000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 10:48:10.680000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 10:48:10.693000&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2021-06-12 10:48:11.223000&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所需结果</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  Status                       t                  Delta</span></span><br><span class="line"><span class="string">0      A 2021-06-12 08:39:24.813                    NaT</span></span><br><span class="line"><span class="string">1      T 2021-06-12 08:39:24.820                    NaT</span></span><br><span class="line"><span class="string">2      A 2021-06-12 08:39:25.210                    NaT</span></span><br><span class="line"><span class="string">3      C 2021-06-12 08:39:25.217 0 days 00:00:00.397000</span></span><br><span class="line"><span class="string">4      C 2021-06-12 08:44:28.830                    NaT</span></span><br><span class="line"><span class="string">5      A 2021-06-12 10:48:10.293                    NaT</span></span><br><span class="line"><span class="string">6      T 2021-06-12 10:48:10.300                    NaT</span></span><br><span class="line"><span class="string">7      T 2021-06-12 10:48:10.680                    NaT</span></span><br><span class="line"><span class="string">8      C 2021-06-12 10:48:10.693 0 days 00:00:00.013000</span></span><br><span class="line"><span class="string">9      A 2021-06-12 10:48:11.223                    NaT</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">temp = (</span><br><span class="line">    df.query(<span class="string">&quot;Status in [&#x27;T&#x27;,&#x27;C&#x27;]&quot;</span>)</span><br><span class="line">    .assign(next_t=(<span class="keyword">lambda</span> x: (x[<span class="string">&quot;Status&quot;</span>] == <span class="string">&quot;C&quot;</span>) &amp; (x[<span class="string">&quot;Status&quot;</span>].shift() == <span class="string">&quot;T&quot;</span>)))</span><br><span class="line">    .assign(prev_c=(<span class="keyword">lambda</span> x: (x[<span class="string">&quot;Status&quot;</span>] == <span class="string">&quot;T&quot;</span>) &amp; (x[<span class="string">&quot;Status&quot;</span>].shift(-<span class="number">1</span>) == <span class="string">&quot;C&quot;</span>)))</span><br><span class="line">    .query(<span class="string">&quot;(next_t == True) | (prev_c == True)&quot;</span>)</span><br><span class="line">    .assign(Delta = <span class="keyword">lambda</span> x:x.t.diff())</span><br><span class="line">    .query(<span class="string">&quot;Status == &#x27;C&#x27;&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> temp.iterrows():</span><br><span class="line">    df.loc[i,<span class="string">&quot;Delta&quot;</span>] = j[<span class="string">&quot;Delta&quot;</span>]</span><br></pre></td></tr></table></figure><hr><h2 id="判断当前值是否在本行之前出现过"><a href="#判断当前值是否在本行之前出现过" class="headerlink" title="判断当前值是否在本行之前出现过"></a><a href="https://gairuo.com/m/pandas-current-appeared-before">判断当前值是否在本行之前出现过</a></h2><blockquote><p>题目：需要增加一列，如果这个数据之前没出现过记为 True，如果出现过记为 False</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;ID&quot;</span>: [<span class="number">123</span>, <span class="number">234</span>, <span class="number">123</span>, <span class="number">234</span>, <span class="number">678</span>]&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>解法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df.assign(是否是新ID = df.index.<span class="built_in">map</span>(<span class="keyword">lambda</span> x:df.loc[x,<span class="string">&quot;ID&quot;</span>] <span class="keyword">not</span> <span class="keyword">in</span> df.loc[:x-<span class="number">1</span>,<span class="string">&quot;ID&quot;</span>].values))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能较好</span></span><br><span class="line">df.assign(是否是新ID=~df.duplicated([<span class="string">&quot;ID&quot;</span>], keep=<span class="string">&quot;first&quot;</span>))</span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> Pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Guide</title>
      <link href="/posts/b08947fa.html"/>
      <url>/posts/b08947fa.html</url>
      
        <content type="html"><![CDATA[<h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><h2 id="Git安装"><a href="#Git安装" class="headerlink" title="Git安装"></a>Git安装</h2><p><a href="https://git-scm.com/">https://git-scm.com/</a></p><h2 id="Node-js安装"><a href="#Node-js安装" class="headerlink" title="Node.js安装"></a>Node.js安装</h2><p><a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p><h2 id="Hexo安装"><a href="#Hexo安装" class="headerlink" title="Hexo安装"></a>Hexo安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 npm 安装 Hexo</span></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hexo初始化</span></span><br><span class="line">hexo init &lt;folder&gt;</span><br><span class="line"><span class="built_in">cd</span> &lt;folder&gt;</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><h1 id="Github配置"><a href="#Github配置" class="headerlink" title="Github配置"></a>Github配置</h1><h2 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h2><blockquote><p>仓库名称必须为<code>用户名 + github.io</code>，可视化为<code>Public</code></p></blockquote><h2 id="git配置"><a href="#git配置" class="headerlink" title="git配置"></a>git配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置用户名和邮箱</span></span><br><span class="line">git config --global user.name <span class="string">&quot;xxx&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;xxx@gmail.com&quot;</span></span><br></pre></td></tr></table></figure><h2 id="SSH-KEY配置"><a href="#SSH-KEY配置" class="headerlink" title="SSH KEY配置"></a>SSH KEY配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建SSH KEY,将用户文件夹下的id_rsa.pub文件的内容复制到github的SSH KEYS中</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;xxx@gmail.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试是否成功连接</span></span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/Ethylenekun/images/img/github_ssh_key.png" alt="github ssh key"></p><blockquote><p>可能会出现错误<code>ssh: connect to host github.com port 22: Connection timed out </code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于默认的 SSH 22 端口被防火墙或网络策略限制，导致无法连接到 GitHub 的服务器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接改为 SSH 的 443 端口</span></span><br><span class="line"><span class="built_in">touch</span> ~/.ssh/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># config文件添加以下内容</span></span><br><span class="line">Host github.com</span><br><span class="line">HostName ssh.github.com</span><br><span class="line">User git</span><br><span class="line">Port 443</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure></blockquote><h2 id="一键部署"><a href="#一键部署" class="headerlink" title="一键部署"></a>一键部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装hexo-deployer-git</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _config.yml配置</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:xxx/xxx.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><h2 id="hexo源文件同步github"><a href="#hexo源文件同步github" class="headerlink" title="hexo源文件同步github"></a>hexo源文件同步github</h2><p><a href="https://midoli.top/2024/12/01/Hexo%E5%9C%A8%E5%A4%9A%E5%8F%B0%E7%94%B5%E8%84%91%E4%B8%8A%E6%8F%90%E4%BA%A4%E5%92%8C%E6%9B%B4%E6%96%B0/">网友教程</a></p><blockquote><p><code>main</code>分支存放hexo生成的静态文件，而<code>source</code>分支设置为默认分支，存放hexo源文件</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制source分支下的文件，仅保留.git文件夹</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:xxx/xxx.github.io.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将源文件除.deploy_git 以外都复制到clone下来的文件夹中</span></span><br><span class="line"><span class="comment"># 删除theme主题文件夹下的.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送源文件到source分支</span></span><br><span class="line">git add .</span><br><span class="line">git commit –m add_branch</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="github图床配置"><a href="#github图床配置" class="headerlink" title="github图床配置"></a>github图床配置</h2><blockquote><p>jsdeliver节点可能存在不可用的网络问题</p></blockquote><ol><li>创建github仓库，并生成token</li><li>配置PicGo(<a href="https://github.com/Molunerfinn/PicGo">PicGo github地址</a>)，设置自定义域名<a href="https://gcore.jsdelivr.net/gh/Ethylenekun/images">https://gcore.jsdelivr.net/gh/Ethylenekun/images</a></li><li>typora设置，图像 - 上传图片 - 上传服务(PicGo_app)</li></ol><h2 id="NAS图床设置"><a href="#NAS图床设置" class="headerlink" title="NAS图床设置"></a>NAS图床设置</h2><p><a href="https://zhuanlan.zhihu.com/p/382702959">知乎教程</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 因PicGO插件功能存在问题,使用命令行安装ftp上传插件</span></span><br><span class="line"><span class="built_in">cd</span> C:\Users\yixi7\AppData\Roaming\picgo</span><br><span class="line">npm install picgo-plugin-ftp-uploader</span><br></pre></td></tr></table></figure><blockquote><p>PicGO FTP上传配置</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/Ethylenekun/images/img/FTP%E4%B8%8A%E4%BC%A0%E8%AE%BE%E7%BD%AE.png" alt="PicGO FTP uploader config"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;NAS&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://xxx:5543/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&#123;year&#125;/&#123;month&#125;/&#123;day&#125;/&#123;fullName&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uploadPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/PicBed/upload/&#123;year&#125;/&#123;month&#125;/&#123;day&#125;/&#123;fullName&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">5542</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>NAS FTP设置：由于上传的用户少，被动端口范围设置为4200-4205</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/Ethylenekun/images/img/image-20251109082126997.png" alt="NAS FTP config"></p><blockquote><p>路由设置：FTP端口转发，FTP服务端口和被动端口都要设置转发</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/Ethylenekun/images/img/image-20251109083334323.png" alt="image-20251109083334323"></p><p><img src="https://gcore.jsdelivr.net/gh/Ethylenekun/images/img/image-20251109083252737.png" alt="image-20251109083252737"></p><h1 id="主题设置"><a href="#主题设置" class="headerlink" title="主题设置"></a>主题设置</h1><p><a href="https://butterfly.js.org/posts/21cfbf15/">Butterfly官方文档</a></p><h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo 根目录运行</span></span><br><span class="line">git <span class="built_in">clone</span> -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用主题 Hexo 根目錄下的 _config.yml，把主題改為 butterfly</span></span><br><span class="line">theme: butterfly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 pug 以及 stylus 的渲染器</span></span><br><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><h3 id="升级建议"><a href="#升级建议" class="headerlink" title="升级建议"></a>升级建议</h3><p>在 hexo 的根目錄創建一個文件 <code>_config.butterfly.yml</code>，並把主題目錄的 <code>_config.yml</code> 內容複製到 <code>_config.butterfly.yml</code> </p><h1 id="Hexo配置文件"><a href="#Hexo配置文件" class="headerlink" title="Hexo配置文件"></a>Hexo配置文件</h1><blockquote><p><code>_config.yml</code>配置文件</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line">title: Ethylene<span class="string">&#x27;s Blog</span></span><br><span class="line"><span class="string">subtitle: &#x27;</span>沉思<span class="string">&#x27;</span></span><br><span class="line"><span class="string">description: &#x27;</span>若遇见你不是奇迹，灵魂便不曾言语<span class="string">&#x27;</span></span><br><span class="line"><span class="string">keywords: &#x27;</span>Python,Pandas,MySQL,Django<span class="string">&#x27;</span></span><br><span class="line"><span class="string">author: Ethylene</span></span><br><span class="line"><span class="string">language: zh-CN</span></span><br><span class="line"><span class="string">timezone: &#x27;</span>Asia/Shanghai<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line">url: https://xxx.xxx.io/</span><br></pre></td></tr></table></figure><h1 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h1><h2 id="文章链接配置"><a href="#文章链接配置" class="headerlink" title="文章链接配置"></a>文章链接配置</h2><p><a href="https://github.com/ohroy/hexo-abbrlink">hexo-abbrlink github地址</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _config.yml配置</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">posts/:abbrlink.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># abbrlink config</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line">  <span class="attr">alg:</span> <span class="string">crc32</span>      </span><br><span class="line">  <span class="attr">rep:</span> <span class="string">hex</span></span><br></pre></td></tr></table></figure><h2 id="live2D配置"><a href="#live2D配置" class="headerlink" title="live2D配置"></a>live2D配置</h2><p><a href="https://github.com/EYHN/hexo-helper-live2d">hexo-helper-live2d github地址</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装模型</span></span><br><span class="line">npm install --save live2d-widget-model-wanko</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _config.yml配置</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">log:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-wanko</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">left</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">150</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">300</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacity:</span> <span class="number">0.7</span></span><br></pre></td></tr></table></figure><h2 id="swiper插件配置"><a href="#swiper插件配置" class="headerlink" title="swiper插件配置"></a>swiper插件配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装swiper依赖</span></span><br><span class="line">npm install hexo-butterfly-swiper --save</span><br></pre></td></tr></table></figure><blockquote><p><code> _config.butterfly.yml</code>配置</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swiper:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 开关</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">5</span> <span class="comment">#过滤器优先权</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">all</span> <span class="comment"># 应用页面</span></span><br><span class="line">  <span class="attr">timemode:</span> <span class="string">date</span> <span class="comment">#date/updated</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="comment"># 挂载容器类型</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">recent-posts</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">default_descr:</span> <span class="string">再怎么看我也不知道怎么描述它的啦！</span></span><br><span class="line">  <span class="attr">swiper_css:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css</span> <span class="comment">#swiper css依赖</span></span><br><span class="line">  <span class="attr">swiper_js:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js</span> <span class="comment">#swiper js依赖</span></span><br><span class="line">  <span class="attr">custom_css:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css</span> <span class="comment"># 适配主题样式补丁</span></span><br><span class="line">  <span class="attr">custom_js:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js</span> <span class="comment"># swiper初始化方法</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">pjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br></pre></td></tr></table></figure><blockquote><p><code>post front-matter</code>配置</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swiper<span class="emphasis">_index: 1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>标签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/style.css"/>
      <url>/css/style.css</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>友情链接</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
